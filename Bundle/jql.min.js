var Ht=await fetch("../src/Resource/defaultTagPermissions.json").then(t=>t.json()),G={isAllowed(t){let e=t?.nodeName.toLowerCase()||"none";return!!Ht[e]},setTagPermission({tagName:t="none",allowed:e=!1}){t=t.toLowerCase(),rawTags[t]&&(rawTags[t]=e)}};var it=await fetch("../src/Resource/attributeStore.json").then(t=>t.json()),Mt=!1;var B={data:/data-[\-\w.\p{L}]/ui,validURL:/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,whiteSpace:/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g,notAllowedValues:/javascript|injected|noreferrer|alert|DataURL/gi},At=t=>{if(Mt&&Object.keys(t.removed).length){let e=Object.entries(t.removed).reduce((n,[o,r])=>[...n,`${o} => ${r}`],[]).join("\\000A");console.info("JQL HTML creation errors:"),console.info(e)}},st=t=>{let e=document.createElement("template"),n={rawHTML:t.outerHTML,removed:{}};e.innerHTML=`<div id="placeholder">${t.outerHTML}</div>`;let o=e.content.querySelector("#placeholder");return o.querySelectorAll("*").forEach(r=>{let s=a(r,SVGElement)?it.svg:it.html;[...r.attributes].forEach(l=>{let g=l.name.trim().toLowerCase(),p=l.value.trim().toLowerCase().replace(B.whiteSpace,""),H=g==="href"?!B.validURL.test(p):B.notAllowedValues.test(p),y=g.startsWith("data")?!B.data.test(g):!!s[g];(H||y)&&(n.removed[`${l.name}`]=`attribute/property (-value) not allowed, remove (value: ${V(l.value||"none",60)})`,r.removeAttribute(l.name))}),G.isAllowed(r)||(n.removed[`<${r.nodeName.toLowerCase()}>`]=`not allowed, not rendered (tag: ${V(r.outerHTML,60)})`,r.remove())}),At(n),o.children[0]};var wt=G.setTagPermission;var S={BeforeBegin:"beforebegin",AfterBegin:"afterbegin",BeforeEnd:"beforeend",AfterEnd:"afterend"},Z=document.createElement("div"),Rt=t=>(Z.innerHTML=t.trim(),Z.childNodes.length?st(Z):void 0),D=(t,e=document.body,n=S.BeforeEnd)=>{if(e=e.isJQL?e.first():e,t){if(a(t,HTMLElement))return e.insertAdjacentElement(n,t);a(t,Comment,Text)&&(n===S.BeforeEnd&&e.appendChild(t),n===S.AfterBegin&&e.insertBefore(t,e.firstElementChild))}},$=t=>{if(t=t.trim(),t.startsWith("<!--")&&t.endsWith("-->"))return document.createComment(t.replace(/<!--|-->$/g,""));let e=Rt(t);return e.children.length?e.children[0]:$(`<span data-jqlcreationerror="1">${N(t,60)}</span>`)};var Y=await fetch("../src/Resource/defaultLogStyling.txt").then(t=>t.text()).then(t=>t.split("~RULE~")),W=!1,j=!1,I=!1,X=!0,Nt=!0,T=()=>document.querySelector("#jql_logger"),ct=()=>{Y&&Ft(b.createStyle("JQLLogCSS"));let t=Nt?"div":"pre",e=`<div id="logBox"><div class="legend"><div></div></div><${t} id="jql_logger"></${t}></div>`;return D($(e),void 0,S.AfterBegin),document.querySelector("#jql_logger")},jt=t=>a(t,String)&&Object.assign(document.createElement("textarea"),{innerHTML:t}).textContent||t,v=(...t)=>{if(!j)return;!I&&!T()&&ct();let e=n=>`${a(n,Object)?JSON.stringify(n,null,2):n}
`;t.forEach(n=>I?console.log(jt(n)):T().insertAdjacentHTML(X?"afterbegin":"beforeend",`${C()} ${e(n.replace(/\n/g,"<br>"))}`))},lt={on(){return W=!0,J("System messages are logged"),W},off(){return W=!1,v("System messages are NOT logged"),W}},J=(...t)=>W&&v(...t),at={get isOn(){return j},isVisible:()=>_(T()),on(){j=!0,I||(T()||ct())?.parentNode.classList.add("visible"),v(`${C()} logging started (to ${I?"console":"document"})`)},off(){T()&&(v(`${C()} debug logging stopped`),T().parentNode.classList.remove("visible")),j=!1},toConsole:{on:()=>{I=!0,j=!0,v(`${C()} debug logging everything to console`)},off(){I=!1,j=!1,v(`${C()} debug logging disabled`)}},remove:()=>{j=!1,T()?.remove(),v(`${C()} logging completely disabled`)},hide:()=>T()?.parentNode.classList.remove("visible"),show:()=>T()?.parentNode.classList.add("visible"),reversed:{on:()=>{X=!0,v(`${C()} Reverse logging reset: now logging bottom to top (latest first)`)},off:()=>{X=!1,v(`${C()} Reverse logging reset: now logging top to bottom (latest last)`)}},clear(){let t=T();t&&(t.textContent=""),v(`${C()} Logging cleared`)}};function Ft(t){Y?.forEach(e=>t(e)),Y=void 0}var dt=t=>t&&(t.textContent=""),K=(t,e)=>t.toLowerCase().trim()===e,k=(t,e)=>{t&&a(e,Object)&&Object.entries(e).forEach(([n,o])=>t.dataset[n]=o)},ut=(t,e,n)=>{let{setStyle:o}=b;n&&a(e,String)&&(e={[e]:n==="-"?"":n});let r;e.className&&(r=e.className,delete e.className),r=[...t.classList].find(u=>u.startsWith("JQLCreated")||r&&u===r)||r||`JQLCreated${U()}`,o(`.${r}`,e),t.classList.add(r)},mt=(t,e)=>{t&&Object.entries(e).forEach(([n,o])=>{n.startsWith("data")&&k(t,{[n]:o}),K(n,"class")&&o.split(/\s+/).forEach(r=>t.classList.add(`${r}`)),a(o,String)&&(t[n]=o)})},It={straigthLoops:{toggleClass:(t,e)=>t.classList.toggle(e),toggleStyleFragments:(t,e)=>t&&Object.entries(e).forEach(([n,o])=>{a(o,Function)&&(o=o(t)),/color/i.test(n)&&(o=o.startsWith("#")?et(o):o.replace(/(,|,\s{2,})(\w)/g,(...r)=>`, ${r[2]}`)),t.style[n]=`${t.style[n]}`==`${o}`?"":o}),removeAttr:(t,e)=>t&&t.removeAttribute(e),toggleAttr:(t,e,n)=>t&&t.hasAttribute(e)?t.removeAttribute(e):t.setAttribute(e,n),empty:dt,clear:dt,replaceClass:(t,e,...n)=>{t.classList.remove(e),n.forEach(o=>t.classList.add(o))},removeClass:(t,...e)=>e.forEach(n=>t.classList.remove(n)),addClass:(t,...e)=>t&&e.forEach(n=>t.classList.add(n)),show:t=>t.style.display="",hide:t=>t.style.display="none",setData:k,assignAttrValues:mt,attr(t,e,n){if(!t)return!0;if(n!==void 0&&(e={[e]:n}),!n&&a(e,String))return t.getAttribute(e);Object.entries(e).forEach(([o,r])=>K(o,"style")?ut(t,r,void 0):K(o,"data")?k(t,r):a(r,Object)?mt(t,r):t.setAttribute(o,r))},style:(t,e,n)=>{n&&a(e,String)&&(e={[e]:n||"none"}),a(e,Object)&&Object.entries(e).forEach(([o,r])=>t.style[o]=r)},css:ut},instanceExtensions:{text:(t,e,n)=>{if(t.isEmpty())return t;let o=r=>r.textContent=n?r.textContent+e:e;return e?A(t,o):t.first().textContent},each:(t,e)=>A(t,e),remove:(t,e)=>{let n=o=>o.remove();if(e){let o=t.find$(e);!o.isEmpty()&&A(o,n);return}A(t,n)},computedStyle:(t,e)=>t.first()&&getComputedStyle(t.first())[e],getData:(t,e,n)=>t.first()&&t.first().dataset&&t.first().dataset[e]||n,isEmpty:t=>t.collection.length<1,is:(t,e)=>{let n=t.first();if(!n)return!0;switch(e){case":visible":return _(n);case":hidden":return!_(n);case":disabled":return n.getAttribute("readonly")||n.getAttribute("disabled");default:return!0}},hasClass:(t,...e)=>{let n=t.first();return t.isEmpty()||!n.classList.length?!1:e.find(o=>n.classList.contains(o))||!1},replace:(t,e,n)=>{let o=t.first();return n.isJQL&&(n=n.first()),o&&e&&(e=a(e,String)?o.querySelector(e):e.isJQL?e.first():e,e&&n&&e.replaceWith(n)),t},replaceMe:(t,e)=>(e=a(e,HTMLElement)?b(e):e,t.parent().replace(t,e),e),val:(t,e)=>{let n=t.first();return!n||!a(n,HTMLInputElement,HTMLSelectElement,HTMLTextAreaElement)?t:e===void 0?n.value:(n.value=`${e}`.length<1?"":e,t)},parent:t=>t.collection.length&&t.first().parentNode&&b(t.first().parentNode)||t,append:(t,...e)=>{if(t.collection.length&&e.length)for(let n=0;n<e.length;n+=1){let o=e[n];if(a(o,String))return t.collection.forEach(r=>r.appendChild($(o))),t;if(O(e[n]))return t.collection.forEach(r=>r.appendChild(is(o,Comment)?o:o.cloneNode(!0))),t;if(e[n].isJQL&&e[n].collection.length){e[n].isVirtual&&o.toDOM();let r=o.collection;o.remove(),r.forEach(s=>t.collection.forEach(u=>u.appendChild(a(s,Comment)?s:s.cloneNode(!0))))}}return t},prepend:(t,...e)=>{if(!t.isEmpty()&&e)for(let n=0;n<e.length;n+=1){let o=e[n];if(a(o,String))return t.collection.forEach(r=>r.insertBefore($(o),r.firstChild)),t;if(O(o))return t.collection.forEach(r=>r.insertBefore(a(o,Comment)?o:o.cloneNode(!0),r.firstChild)),t;if(o.isJQL&&!o.isEmpty()){let r=o.collection.slice();o.remove(),r.forEach(s=>t.collection.forEach(u=>u&&u.insertBefore(a(s,Comment)?s:s.cloneNode(!0),u.firstChild)))}}return t},appendTo:(t,e)=>(e.isJQL||(e=t.virtual(e)),e.append(t)),prependTo:(t,e)=>(e.isJQL||(e=t.virtual(e)),e.prepend(t)),single:(t,e="0")=>t.collection.length>0?isNaN(+e)&&t.find(e)?t.find$(e):+e<t.collection.length?b(t.collection[e]):b(t.collection.slice(-1)):t,toNodeList:t=>{let e=document.createElement("div");for(let n of t.collection){let o=document.importNode(n,!0);o.removeAttribute("id"),e.append(o)}return e.childNodes},duplicate:(t,e=!1)=>{let n=t.toNodeList();return e?b(n):t.virtual(n)},toDOM:(t,e=document.body,n=S.BeforeEnd)=>(t.isVirtual&&(t.isVirtual=!1,P(t.collection,e,n)),t),first:(t,e=!1)=>{if(t.collection.length>0)return e?t.single():t.collection[0]},first$:(t,e)=>t.single(e),find:(t,e)=>t.first()?.querySelectorAll(e)||[],find$:(t,e)=>{let n=t.collection.reduce((o,r)=>[...o,[...r.querySelectorAll(e)]],[]).flat().filter(o=>a(o,HTMLElement));return n.length&&b(n[0])||b()},prop:(t,e,n)=>n?t.collection.length?A(t,o=>o[e]=n):t:t.collection.length?t.first()[e]:t,on:(t,e,n)=>{if(t.collection.length){let o=ft(t);b.handle(t,e,o,n)}return t},html:(t,e,n)=>{if(e===void 0)return t.first()?.innerHTML;if(!t.isEmpty()){let o=e.isJQL?e.first():$(`<div>${e}</div>`);if(!a(o,Comment))return A(t,s=>s.innerHTML=n?s.innerHTML+o.innerHTML:o.innerHTML)}return t},outerHtml:t=>(t.first()||{outerHTML:void 0}).outerHTML,htmlFor:(t,e,n="",o=!1)=>{if(e&&t.collection.length){let r=t.find$(e);if(!r)return t;if("{htmlValue}".trim().length<1)return r.textContent="",t;let s=$(`<div>${n}</div>`);s&&r.html(s.innerHTML,o)}return t},dimensions:t=>t.first()?.getBoundingClientRect(),delegate:(t,e,n,...o)=>(o.forEach(r=>b.handle(t,e,n,r)),t),ON:(t,e,...n)=>(t.collection.length&&n.forEach(o=>t.on(e,o)),t),trigger:(t,e,n=Event,o={})=>{if(t.collection.length){let r=new n(e,{...o,bubbles:o.bubbles??!0});for(let s of t.collection)s.dispatchEvent(r)}return t}}},tt=It;var pt=Jt,gt=await fetch("../src/Resource/defaultPopupStyling.txt").then(t=>t.text()).then(t=>t.split("~RULE~"));function Jt(t){let e=t(document.body),n=t.createStyle("JQLPopupCSS");Ot(n);let o,r,s="ontouchstart"in document.documentElement?"touchend":"click";t.delegate(s,"#closer, .between",L);let u=()=>(x(),E.hasClass("active")&&E.removeClass("active"),E.addClass("active"),o=setTimeout(()=>E.removeClass("active"),2500),!0),l=(()=>{let i=!1;return{set isModal({state:d=!1}){i=d},get isModal(){return i},get isActive(){return i&&p.hasClass("active")&&u()}}})(),g=i=>{let d=t('<div class="popupContainer">').append(t('<span id="closer" class="closeHandleIcon"></span>').prop("title","Click here or anywhere outside the box to close")).append('<div class="popupBox"><div id="modalWarning"></div><div data-modalcontent></div></div>'),f=t("#closer"),R=t('<div class="between"></div>');return[d,R,f,t("#modalWarning")]},[p,H,y,E]=g(),M=()=>{t(".between").removeClass("active").style({top:0}),t("#closer, .popupContainer, #modalWarning").removeClass("active"),t("[data-modalcontent]").empty()},q=(i,d)=>{t(".between, .popupContainer").addClass("active"),p.style({height:"auto",width:"auto"}),H.style({top:`${scrollY}px`}),e.addClass("popupActive"),d&&d.addClass("active")},x=()=>o&&clearTimeout(o),w=({message:i,reallyModal:d,callback:f})=>{if(l.isModal={state:d},r=f,!i.isJQL&&!a(i,String))return h(t('<b style="color:red">Popup not created: invalid input</b>'),2);x(),t(".popupBox > [data-modalcontent]").empty().append(i.isJQL?i:t(`<div>${i}</div>`)),q(p,l.isModal?void 0:y)},m=(i,d=!1,f=void 0)=>!l.isActive&&w({message:i,reallyModal:d,callback:f}),h=(i,d=2,f=null)=>{if(l.isActive)return;M(),m(i,!1,f),o=setTimeout(f?()=>L(f):L,d*1e3)};function L(i){if(x(),l.isActive)return;let d=a(i,Function)?i:r;if(a(d,Function))return r=void 0,d();M();let f=parseFloat(p.computedStyle("transitionDuration"))*1e3;o=setTimeout(()=>e.removeClass("popupActive"),f)}return{create:m,createTimed:h,remove:L,removeModal:i=>{l.isModal=!1,L(i)}}}function Ot(t){gt.forEach(e=>t(e)),gt=void 0}var F={},ht=t=>{let e=r=>F[r.type].forEach(s=>s(r)),n=(r,s)=>u=>{let l=u.target.closest(r);return l&&s(u,t(l))},o=r=>!Object.keys(F).find(s=>s===r)&&document.addEventListener(r,e);return(r,s,u,l)=>{o(s);let g=u?n(u,l):l;F=F[s]?{...F,[s]:F[s].concat(g)}:{...F,[s]:[g]}}};var nt=Qt;function Qt({styleSheet:t,createWithId:e}){let{cssRuleFromText:n,checkAtRules:o,toDashedNotation:r,IS:s,shortenRule:u,consider:l,ruleExists:g,checkParams:p,atMedia2String:H,sheet:y}=qt({styleSheet:t,createWithId:e}),E=(m,h)=>Object.entries(h).forEach(([L,c])=>m.style.setProperty(r(L),c)),M=(m,h,L=y)=>{if(!s(m,String)||!m.trim().length||/[;,]$/g.test(m.trim()))return console.error(`StylingFactory instance (setRules): [${m||"[no selector given]"}] is not a valid selector`);let c=g(m,!0),i=c||L.cssRules[L.insertRule(`${m} {}`,L.cssRules.length||0)];return l(()=>E(i,h),m,c)},q=m=>{let h=m.trim().split(/{/,2),L=h.shift().trim();if(!s(L,String)||!L.trim())return console.error(`StylingFactory instance (doParse): no (valid) selector could be extracted from rule ${u(m)}`);let c=n(h);return M(L,c)},x=m=>{let h=o(m);return h.done?h.existing:q(m)},w=(m,h)=>m.trim().startsWith("@media")?x(H(m,h)):M(m,h);return(m,h={})=>p(m,h)&&(Object.keys(h).length?w(m,h):x(m))}function qt({styleSheet:t,createWithId:e}){let n="Note: The rule or some of its properties may not be supported by your browser (yet)",o=c=>c.replace(/([*\[\]()-+{}.$?\\])/g,"\\$1");t=e?(c=>document.head.insertAdjacentElement("beforeend",Object.assign(document.createElement("style"),{id:c,type:"text/css"})).sheet)(e):t;let s=(c,...i)=>{let d=i.length&&Array.isArray(i.slice(-1))?i.pop().join(""):"";return new RegExp((i.length&&c.raw.reduce((f,R,Tt)=>f.concat(i[Tt-1]||"").concat(R),"")||c.raw.join("")).split(`
`).map(f=>f.replace(/\s|\/\/.*$/g,"").trim().replace(/(@s!)/g," ")).join(""),d)},u=(c,i)=>[...t.rules].find(d=>i?M(d.selectorText||"",c):s`${o(c)}${[..."gim"]}`.test(d.cssText)),l=c=>/@import|@charset|@font-face/i.test(c)?{existing:w(c,0),done:!0}:H.test(c)?{ok:w(c,t.cssRules.length),done:!0}:{ok:!1,done:!1},g=(c,...i)=>!!i.find(d=>p(c,d)),p=(c,...i)=>{if(i.length>1)return g(c,...i);i=i.shift();let d="Invalid parameter(s)",f=c===0?Number:c===""?String:c?Object.getPrototypeOf(c)?.constructor:{name:d};return i?i===f?.__proto__||i===f:f?.name??d},H=s`@keyframes | @font-feature-values | @font-palette-values 
    | @layer | @namespace | @page | @counter-style | @container | @media ${["i"]}`,y=c=>c[0].trim().replace(/[}{]/,"").split(`
`).map(i=>i.trim()).filter(i=>i).reduce((i,d)=>{let[f,R]=[d.slice(0,d.indexOf(":")).trim(),d.slice(d.indexOf(":")+1).trim().replace(/;$|;.+(?=\/*).+\/$/,"")];return f&&R?{...i,[f]:R}:i},{}),E=c=>c.replace(/[A-Z]/g,i=>`-${i.toLowerCase()}`).replace(/[^--]^-|-$/,""),M=(c,i)=>c?.replace("::",":")===i?.replace("::",":"),q=(c,i)=>c&&p(c,String)&&c.trim().length&&p(i,Object)||(console.error("StylingFactory instance called with invalid parameters"),!1),x=c=>{let i=(c||"NO RULE").trim().slice(0,50).replace(/\n/g,"\\n").replace(/\s{2,}/g," ");return c.length>i.length?`${i.trim()}...truncated`:i},w=c=>{c=c.trim();let i=!!u(c.slice(0,c.indexOf("{")));try{return t.insertRule(`${c}`,t.cssRules.length),i}catch(d){return console.error(`StylingFactory instance (tryParse) ${d.name} Error:
${d.message}
Rule: ${x(c)}
${n}`),i}},m=(c,i,d)=>{try{return c(),d}catch(f){return console.error(`StylingFactory instance (tryAddOrModify) ${f.name} Error:
${f.message}
Rule: ${x(i)}
${n}`),d}},h=c=>Object.entries(c).map(([i,d])=>`${i}: ${d.trim()}`).join(`;
`);return{sheet:t,cssRuleFromText:y,checkAtRules:l,ruleExists:u,atMedia2String:(c,i)=>`${c.trim()} ${Object.entries(i).map(([d,f])=>`${d}: { ${h(f)}`)}`,toDashedNotation:E,checkParams:q,tryParse:w,consider:m,IS:p,shortenRule:x}}var Wt=[...Array(26)].map((t,e)=>String.fromCharCode(e+65)).concat([...Array(26)].map((t,e)=>String.fromCharCode(e+97))).concat([...Array(10)].map((t,e)=>`${e}`)),Lt="Invalid parameter(s)",z=(t,e=2)=>`${t}`.padStart(e,"0"),_t=(t,...e)=>!!e.find(n=>a(t,n)),Bt=(t,e=0)=>([t,e]=[Math.floor(t),e=Math.ceil(e)],Math.floor([...crypto.getRandomValues(new Uint32Array(1))].shift()/2**32*(t-e+1)+e)),Vt=t=>{let e=t.length;for(;e--;){let n=Bt(e);[t[e],t[n]]=[t[n],t[e]]}return t},Dt=t=>(t=(t.trim().startsWith("#")?t.slice(1):t).trim(),t.length===3?[...t].map(e=>e+e).join(""):t),N=(t,e=120)=>t.trim().slice(0,e).replace(/>\s+</g,"><").replace(/</g,"&lt;").replace(/\s{2,}/g," ").replace(/\n/g,"\\n")+(t.length>e?"&hellip;":"").trim();var a=(t,...e)=>{if(e.length>1)return _t(t,...e);e=e.shift();let n=t===0?Number:t===""?String:t?Object.getPrototypeOf(t)?.constructor:{name:Lt};return e?e===n?.__proto__||e===n:n?.name??Lt},U=()=>`_${Vt(Wt).slice(0,8).join("")}`,V=(t,e=120)=>N(t,e).replace(/&lt;/g,"<").replace(/&hellip;/g,"..."),C=()=>(t=>`[${z(t.getHours())}:${z(t.getMinutes())}:${z(t.getSeconds())}.${z(t.getMilliseconds(),3)}]`)(new Date),et=function(t,e=100){t=Dt(t.slice(1));let n=e%100!==0;return`rgb${n?"a":""}(${parseInt(t.slice(0,2),16)}, ${parseInt(t.slice(2,4),16)}, ${parseInt(t.slice(-2),16)}${n?`, ${e/100}`:""})`};var yt=tt.instanceExtensions,Et=tt.straigthLoops,St=t=>a(t,Comment,Text),O=t=>a(t,Text,HTMLElement,Comment),ot=t=>a(t,String)&&/^<|>$/.test(`${t}`.trim()),bt=t=>a(t,Array)&&!t?.find(e=>!ot(e)),rt=t=>a(t,Array)&&!t?.find(e=>!O(e)),vt=t=>t?.filter(e=>e).reduce((e,n)=>e.concat(St(n)?n.textContent:n.outerHTML),""),$t=t=>t?a(t,NodeList)?[...t]:O(t)?[t]:rt(t)?t:t.isJQL?t.collection:void 0:[],Ct=(t,e,n)=>{let o=e!==document.body&&a(t,String)&&t.toLowerCase()!=="body"?e:document,r;try{n.collection=[...o.querySelectorAll(t)]}catch{r=`Invalid CSS querySelector. [${t}]`}return r??`(JQL log) css querySelector [${t}], output ${n.collection.length} element(s)`},A=(t,e)=>{let n=t.collection.filter(o=>!St(o));for(let o=0;o<n.length;o+=1)e(n[o],o);return t},Q=t=>{let e=s=>(...u)=>a(s,Function)&&s(Q(t),...u),n=s=>(...u)=>a(s,Function)&&A(Q(t),l=>s(l,...u)),o=s=>Et[s]&&n(Et[s])||yt[s]&&e(yt[s]),r={get:(s,u)=>o(u)??(a(+u,Number)?s.collection?.[u]:s[u])};return new Proxy(t,r)},P=(t=[],e=document.body,n=S.BeforeEnd)=>t.reduce((o,r)=>{let s=O(r)&&D(r,e,n);return s?[...o,s]:o},[]),ft=t=>{let e=t.first().dataset.hid||`HID${U()}`;return t.setData({hid:e}),`[data-hid="${e}"]`},_=function(t){if(!t)return!1;let e=t.style,n=getComputedStyle(t),o=[e.visibility,n.visibility].includes("hidden"),r=[e.display,n.display].includes("none"),s=t.offsetTop<0||t.offsetLeft+t.offsetWidth<0||t.offsetLeft>document.body.offsetWidth,u=+n.opacity==0||+(e.opacity||1)==0;return!(s||u||r||o)};var Ut={debugLog:at,log:v,setSystemLog:lt,insertPositions:S,text:(t,e=!1)=>e?document.createComment(t):document.createTextNode(t),node:(t,e=document.body)=>document.querySelector(t,e),nodes:(t,e=document.body)=>document.querySelectorAll(t,e)},xt=t=>{let e=l=>t(l,document.createElement("br")),n=nt({createWithId:"JQLStylesheet"}),o=l=>nt({createWithId:l}),r=ht(t),s=(l,g,...p)=>a(g,Function)?(p.push(g),r(null,l,null,...p)):r(null,l,g,...p),u={...Ut,setStyle:n,createStyle:o,virtual:e,handle:r,popup:()=>pt(t),delegate:(l,g,...p)=>a(g,Function)?(p.push(g),r(null,l,null,...p)):r(null,l,g,...p)};return Object.entries(u).forEach(([l,g])=>t[l]=g),t};var b=xt(Pt());function Pt(){return function(e,n=document.body,o=S.BeforeEnd){let r=ot(e),s=bt(e),u=!a(n,HTMLBRElement)&&s||r,l={collection:$t(e)??[],isVirtual:a(n,HTMLBRElement),isJQL:!0,insertPositions:S},g=rt(l.collection),p=`(JQL log) raw input: [${N(s?e.join(""):g?`Element(s): ${l.collection.map(y=>y.outerHTML||y.textContent).join("")}`:e,80)}]`;if(l.collection.length&&g)return J(p),Q(l);if(u&&[e].flat().forEach(y=>l.collection.push($(y))),u&&l.collection.length>0){let y=l.collection.filter(E=>E.dataset?.jqlcreationerror);return l.collection=l.collection.filter(E=>!E.dataset?.jqlcreationerror),J(`${p}
  Created ${l.isVirtual?" VIRTUAL":""} (outerHTML truncated) [${N(vt(l.collection)||"sanitized: no elements remaining",80)}]`),y.length&&console.error(`JQL: illegal html, not rendered: "${y.reduce((E,M)=>E.concat(`${M.textContent}
`),"").trim()}"`),l.isVirtual||P(l.collection,n,o),Q(l)}let H=Ct(e,n,l);return J(H),Q(l)}}export{b as default};
